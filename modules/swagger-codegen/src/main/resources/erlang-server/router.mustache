-module({{packageName}}_router).

-export([get_paths/2]).
-export([get_operations/0]).

get_paths(LogicHandler, SwaggerPath) ->
    ValidatorState = prepare_validator(SwaggerPath),
    Paths = lists:usort(lists:foldl(
        fun({_, Path, _, Handler}, Acc) ->
            [{Path, Handler} | Acc]
        end,
        [],
        get_operations()
    )),
    [
        {'_',
            [{P, H, [LogicHandler, ValidatorState]} || {P, H} <- Paths]
        }
    ].

prepare_validator(SwaggerPath) ->
    R = jsx:decode(element(2, file:read_file(SwaggerPath))),
    jesse_state:new(R, [{default_schema_ver, <<"http://json-schema.org/draft-04/schema#">>}]).


get_operations() ->
    [{{#apiInfo}}{{#apis}}{{#operations}}{{#operation}}
        {'{{operationId}}', "{{path}}", <<"{{httpMethod}}">> ,'{{classname}}'}{{#hasMore}},{{/hasMore}}{{/operation}}{{#hasMore}},{{/hasMore}}{{/operations}}{{/apis}}{{/apiInfo}}
    ].
