-module({{packageName}}_router).

-export([get_paths/1]).

get_paths(LogicHandler) ->
    ValidatorState = prepare_validator(),
    Paths = lists:usort(maps:fold(
        fun(_, #{path := Path, handler := Handler}, Acc) ->
            [{Path, Handler} | Acc]
        end,
        [],
        {{packageName}}_api:get_operations()
    )),
    [
        {'_',
            [{P, H, [LogicHandler, ValidatorState]} || {P, H} <- Paths]
        }
    ].

prepare_validator() ->
    R = jsx:decode(element(2, file:read_file(get_swagger_path()))),
    jesse_state:new(R, [{default_schema_ver, <<"http://json-schema.org/draft-04/schema#">>}]).


get_swagger_path() ->
    {ok, AppName} = application:get_application(?MODULE),
    filename:join({{packageName}}_utils:priv_dir(AppName), "swagger.json").
